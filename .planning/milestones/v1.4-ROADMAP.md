# Milestone v1.4: GM Character Manipulation + Concentration System

**Status:** SHIPPED 2026-01-29
**Phases:** 17-22
**Total Plans:** 21

## Overview

This milestone completes GM character manipulation powers by enabling direct health management, wound tracking, effect application, inventory control, and stat editing from the GM dashboard. Additionally, it implements the complete concentration system for casting-time and sustained effect mechanics.

## Phases

### Phase 17: Health Management

**Goal**: GM can apply damage and healing to character FAT/VIT pools through the dashboard
**Depends on**: Phase 16 (v1.2 dashboard foundation)
**Requirements**: HLTH-01, HLTH-02, HLTH-03, HLTH-04, HLTH-05, HLTH-06, HLTH-07
**Plans**: 2 plans

Plans:
- [x] 17-01-PLAN.md — Enhance PendingPoolBar with color thresholds and overheal support
- [x] 17-02-PLAN.md — Refactor CharacterDetailGmActions to mode toggle with warnings

**Details:**
- Theme-aware color-coded health bars (green >50%, yellow 25-50%, red <25%)
- Overheal badge indicator for temporary buffs
- Two-button FAT/VIT layout for faster damage/healing application
- Inline alert warnings for damage/healing mode

### Phase 18: Wound Management

**Goal**: GM can add, remove, and edit wounds on characters with severity tracking
**Depends on**: Phase 17
**Requirements**: WOND-01, WOND-02, WOND-03, WOND-04
**Plans**: 2 plans

Plans:
- [x] 18-01-PLAN.md — Extend WoundState and create wound CRUD modals
- [x] 18-02-PLAN.md — Header wound badges and VIT damage wound prompt

**Details:**
- Four fixed severity levels (Minor/Moderate/Severe/Critical)
- Severity auto-fills AS penalty and FAT/VIT rates with GM override
- Seven common wound templates for quick entry
- Wound badge colors match severity

### Phase 19: Effect Management

**Goal**: GM can create, apply, edit, and template effects on characters
**Depends on**: Phase 18
**Requirements**: EFCT-01 through EFCT-10
**Plans**: 4 plans

Plans:
- [x] 19-01-PLAN.md — EffectState model and DAL layer for effect templates
- [x] 19-02-PLAN.md — CSLA business objects (EffectTemplate, EffectTemplateList, GenericEffectBehavior)
- [x] 19-03-PLAN.md — Effect management UI (EffectManagementModal, EffectFormModal)
- [x] 19-04-PLAN.md — Template picker and Effects tab integration

**Details:**
- Dictionary-based modifiers for attribute/skill flexibility
- Behavior tags as list for multi-behavior effects
- Card grid layout for effect display
- Debounced template search (300ms)
- Table layout for Effects tab

### Phase 20: Inventory Manipulation

**Goal**: GM can directly add, remove, and manage items in character inventory
**Depends on**: Phase 19
**Requirements**: INVT-01 through INVT-08
**Plans**: 3 plans

Plans:
- [x] 20-01-PLAN.md — ItemTemplatePickerModal for browsing/selecting item templates
- [x] 20-02-PLAN.md — CharacterDetailInventory GM actions and currency editing
- [x] 20-03-PLAN.md — (Gap closure) Fix CharacterDetailModal integration

**Details:**
- Rarity colors for items (secondary/success/primary/purple/warning)
- Inline quantity prompt for stackable items
- Dropdown context menus for item actions
- Currency editing via edit mode toggle

### Phase 21: Stat Editing

**Goal**: GM can directly modify character attributes and skills
**Depends on**: Phase 20
**Requirements**: STAT-01 through STAT-06
**Plans**: 2 plans

Plans:
- [x] 21-01-PLAN.md — Attribute editing with edit mode toggle in CharacterDetailSheet
- [x] 21-02-PLAN.md — Skill editing and CharacterDetailModal coordination

**Details:**
- Pencil button on Attributes card header for inline edit mode
- IsEditMode two-way binding with EventCallback for parent coordination
- Health pools capped at new max on save
- All skills visible in edit mode for complete editing
- Combined SaveAllChanges for attributes and skills together
- AP capped at new max when skills reduced

### Phase 22: Concentration System

**Goal**: Implement both casting-time and sustained effect concentration mechanics
**Depends on**: Phase 21
**Requirements**: CONC-01 through CONC-15
**Plans**: 8 plans

Plans:
- [x] 22-01-PLAN.md — ConcentrationState schema, EffectRecord linking properties, payload classes
- [x] 22-02-PLAN.md — ConcentrationBehavior: casting time (OnTick progress, OnExpire execution, OnRemove cleanup)
- [x] 22-03-PLAN.md — ConcentrationBehavior: sustained effects (FAT/VIT drain, linked effect removal)
- [x] 22-04-PLAN.md — CharacterEdit concentration methods (GetConcentrationEffect, CheckConcentration)
- [x] 22-05-PLAN.md — ConcentrationBreakDialog component for action confirmation
- [x] 22-06-PLAN.md — Defense integration (concentration check on passive defense with damage penalty)
- [x] 22-07-PLAN.md — ConcentrationIndicator UI component for status display
- [x] 22-08-PLAN.md — (Gap closure) Action integration with ConcentrationBreakDialog

**Details:**
- JSON blob storage continues (no schema migration for SQLite)
- Effect linking via SourceEffectId/SourceCasterId
- Nested payload JSON for deferred actions
- CompleteEarly vs ExpireEarly distinction for OnExpire vs OnRemove
- Drain via PendingDamage pattern (matches health pool processing)
- Focus AS + damage penalty for concentration checks
- No Focus skill = automatic concentration failure
- WeaponAmmoState.LoadedAmmo for magazine reload completion
- Same concentration check pattern for all active actions

---

## Milestone Summary

**Key Decisions:**
- Two-button FAT/VIT layout for faster damage/healing application
- Four fixed severity levels with auto-fill defaults for wounds
- Dictionary-based modifiers for effect attribute/skill flexibility
- Rarity-based item color coding
- Edit mode toggle pattern with two-way binding
- JSON blob storage for concentration state (no schema migration)
- Focus skill check for concentration with damage penalty

**Issues Resolved:**
- Gap closure for CharacterDetailModal integration (20-03)
- Gap closure for action integration with ConcentrationBreakDialog (22-08)

**Technical Debt Incurred:**
- ArmorInfoFactory.cs orphaned (from v1.0)
- Weapon filtering logic in UI layer (from v1.0)
- Case sensitivity inconsistencies (from v1.0)

---

*Archived: 2026-01-29 as part of v1.4 milestone completion*
*For current project status, see .planning/ROADMAP.md (next milestone)*
