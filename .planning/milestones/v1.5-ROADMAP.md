# Milestone v1.5: NPC Management System

**Status:** ✅ SHIPPED 2026-02-03
**Phases:** 23-27
**Total Plans:** 20

## Overview

This milestone enabled GMs to create, manage, and run NPCs in combat encounters alongside player characters. NPCs use the existing CharacterEdit model with an IsNpc flag, providing 100% feature parity with PCs. The template pattern follows the proven ItemTemplate approach for pre-session prep, while quick-spawn enables improvisation during play.

## Phases

### Phase 23: Data Model Foundation

**Goal:** Character model supports NPC and template flags with database schema ready for NPC features.
**Depends on:** None (first phase)
**Plans:** 2 plans

Plans:
- [x] 23-01-PLAN.md — Add NPC flags to Character DTO and CharacterEdit business object
- [x] 23-02-PLAN.md — Add DAL query methods and unit tests for NPC flags

**Requirements:**
- CRTN-02 (partial): NPCs have full character stats (same model as PCs)

**Completed:** 2026-02-01

---

### Phase 24: NPC Template System

**Goal:** GMs can build and organize a library of NPC templates for pre-session encounter prep.
**Depends on:** Phase 23 (data model)
**Plans:** 5 plans

Plans:
- [x] 24-01-PLAN.md — Data model extensions (NpcDisposition enum, template properties, DAL methods)
- [x] 24-02-PLAN.md — Template list business objects (NpcTemplateInfo, NpcTemplateList)
- [x] 24-03-PLAN.md — Template library UI page with search/filter
- [x] 24-04-PLAN.md — Template editor UI page with clone functionality
- [x] 24-05-PLAN.md — Polish: category autocomplete, inactive styling, difficulty badges

**Requirements:**
- TMPL-01: GM can create NPC templates with full character stats
- TMPL-02: GM can edit existing NPC templates
- TMPL-03: GM can browse/search NPC templates (filter by category/tags)
- TMPL-04: GM can delete/deactivate NPC templates
- TMPL-05: NPC templates support category tags for organization

**Completed:** 2026-02-02

---

### Phase 25: NPC Creation & Dashboard

**Goal:** GMs can spawn NPCs from templates during play and see them in the dashboard with full manipulation powers.
**Depends on:** Phase 24 (templates exist to spawn from)
**Plans:** 6 plans

Plans:
- [x] 25-01-PLAN.md — Data model extensions (SourceTemplateId/Name, TableCharacterInfo NPC fields)
- [x] 25-02-PLAN.md — NPC auto-naming service with global counter and prefix memory
- [x] 25-03-PLAN.md — NPC spawner CSLA command (clone template to new character)
- [x] 25-04-PLAN.md — Spawn modal UI with template library integration
- [x] 25-05-PLAN.md — Dashboard NPC section with disposition grouping
- [x] 25-06-PLAN.md — Integration: dashboard spawn button and end-to-end workflow

**Requirements:**
- CRTN-01: GM can quick-create NPC from template
- CRTN-02: NPCs have full character stats (same model as PCs)
- CRTN-03: Smart naming auto-generates unique names
- CRTN-04: GM can add session-specific notes to individual NPC instances
- DASH-01: NPCs appear in GM dashboard in separate section from PCs
- DASH-02: NPC status cards show same info as PC cards
- DASH-03: NPC detail modal provides same manipulation powers as PCs
- DASH-04: NPCs display disposition marker with visual differentiation

**Completed:** 2026-02-02

---

### Phase 26: Visibility & Lifecycle

**Goal:** GMs can hide NPCs for surprise encounters and manage NPC persistence across sessions.
**Depends on:** Phase 25 (NPCs exist to hide/manage)
**Plans:** 5 plans

Plans:
- [x] 26-01-PLAN.md — Data model extensions (TableCharacterInfo.VisibleToPlayers, IsArchived, DAL methods)
- [x] 26-02-PLAN.md — Visibility toggle (spawn hidden, Hidden section, HiddenNpcCard, modal toggle)
- [x] 26-03-PLAN.md — NPC lifecycle - dismiss/archive/delete in CharacterDetailAdmin
- [x] 26-04-PLAN.md — NPC archive browser page with restore flow
- [x] 26-05-PLAN.md — Save as template (NpcTemplateCreator command, modal integration)

**Requirements:**
- VSBL-01: GM can toggle NPC visibility
- VSBL-02: Hidden NPCs do not appear in player-visible views
- VSBL-03: Visibility toggle is accessible from both status card and detail modal
- LIFE-01: GM can remove/dismiss NPCs from active table
- LIFE-02: NPCs persist across sessions until explicitly dismissed
- LIFE-03: GM can save active NPC as new template
- LIFE-04: Dismissed NPCs can be optionally deleted or archived

**Completed:** 2026-02-03

---

### Phase 27: Time & Combat Integration

**Goal:** NPCs participate fully in combat rounds with time advancement affecting them identically to PCs.
**Depends on:** Phase 26 (NPCs fully manageable)
**Plans:** 2 plans

Plans:
- [x] 27-01-PLAN.md — NPC target loading and selection UI (TableCharacterList, disposition grouping)
- [x] 27-02-PLAN.md — Combat polish (target invalidation, reveal activity log)

**Requirements:**
- CMBT-01: NPCs participate in round/time advancement
- CMBT-02: NPCs can be targeted by combat actions
- CMBT-03: Time advancement applies to NPCs same as PCs

**Completed:** 2026-02-03

---

## Milestone Summary

**Key Decisions:**

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| NPCs use existing CharacterEdit model | 100% feature parity with PCs, no parallel model maintenance | ✓ Good |
| Template pattern follows ItemTemplate approach | Proven pattern, consistent UX | ✓ Good |
| Spawn hidden by default | Surprise encounters are common GM need | ✓ Good |
| Global auto-naming counter | Avoids confusion between templates | ✓ Good |
| Disposition grouping in dashboard | Visual organization for combat management | ✓ Good |
| VisibleToPlayers filter in targeting | Prevents hidden NPCs leaking to players | ✓ Good |
| Archive vs delete option | Preserves useful NPCs while cleaning dashboard | ✓ Good |
| Save-as-template resets health | Fresh NPC definition, not combat state | ✓ Good |

**Issues Resolved:**

None - clean milestone execution with no blockers.

**Issues Deferred:**

- Group management (batch actions) deferred to v1.6+
- Initiative system deferred to v1.6+

**Technical Debt Incurred:**

None - all implementations are production-ready.

---

*For current project status, see .planning/ROADMAP.md (fresh for next milestone)*

---
*Archived: 2026-02-03 as part of v1.5 milestone completion*
