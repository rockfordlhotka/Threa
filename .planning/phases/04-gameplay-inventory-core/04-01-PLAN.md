---
phase: 04-gameplay-inventory-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Threa/Threa.Client/Components/Pages/GamePlay/TabPlayInventory.razor
autonomous: true

must_haves:
  truths:
    - "Player can see all items in their inventory as a grid of tiles"
    - "Player can see all equipment slots grouped by category"
    - "Player can see which items are currently equipped (badge on inventory tile + shown in slot)"
    - "Player can see item name and quantity on each tile"
    - "Empty equipment slots show placeholder text"
  artifacts:
    - path: "Threa/Threa.Client/Components/Pages/GamePlay/TabPlayInventory.razor"
      provides: "Inventory grid and equipment slots display"
      contains: "inventory-grid"
  key_links:
    - from: "TabPlayInventory.razor"
      to: "ICharacterItemDal"
      via: "@inject ICharacterItemDal"
      pattern: "ICharacterItemDal"
    - from: "TabPlayInventory.razor"
      to: "IItemTemplateDal"
      via: "@inject IItemTemplateDal"
      pattern: "IItemTemplateDal"
---

<objective>
Create the inventory grid display and equipment slots view for the Play page Inventory tab.

Purpose: Players need to see their items during gameplay - both what's in their inventory and what's equipped. This replaces the placeholder component with a functional grid-based inventory view and categorized equipment slots list.

Output: Fully functional TabPlayInventory.razor with CSS grid inventory display and equipment slot categories.
</objective>

<execution_context>
@C:\Users\rocky\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rocky\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-gameplay-inventory-core/04-CONTEXT.md
@.planning/phases/04-gameplay-inventory-core/04-RESEARCH.md

# Existing code patterns
@Threa/Threa.Client/Components/Pages/GamePlay/TabPlayInventory.razor
@GameMechanics/Items/ItemManagementService.cs
@Threa.Dal/Dto/EquipmentSlot.cs
@Threa.Dal/Dto/EquipmentSlotExtensions.cs
@Threa.Dal/IItemDal.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Inventory Grid with Item Tiles</name>
  <files>Threa/Threa.Client/Components/Pages/GamePlay/TabPlayInventory.razor</files>
  <action>
Replace the entire TabPlayInventory.razor with a new implementation:

1. Add service injections at the top:
   - @inject ICharacterItemDal itemDal
   - @inject IItemTemplateDal templateDal
   - @inject GameMechanics.Items.ItemManagementService itemService

2. Create two-column Bootstrap layout (per CONTEXT.md and RESEARCH.md):
   - Left column (col-md-7): Inventory grid
   - Right column (col-md-5): Equipment slots

3. Implement inventory grid using CSS Grid (NOT RadzenDataGrid - per CONTEXT.md "grid-based display with icons"):
   - Container div with class "inventory-grid"
   - CSS: `display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px;`
   - Each item as .inventory-tile div containing:
     - Item icon (use first letter of item type or name as text icon for MVP - no IconUrl exists)
     - Item name (truncated with ellipsis)
     - Quantity badge (bottom-right) for stackable items with StackSize > 1
     - Equipped badge ("E" top-right) if item.IsEquipped is true

4. Add tile CSS styles inline or in a style block:
   ```css
   .inventory-grid {
       display: grid;
       grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
       gap: 8px;
       max-height: 500px;
       overflow-y: auto;
       padding: 8px;
       background: var(--color-bg-secondary, #f8f9fa);
       border-radius: 4px;
   }
   .inventory-tile {
       position: relative;
       display: flex;
       flex-direction: column;
       align-items: center;
       justify-content: center;
       padding: 8px;
       border: 1px solid #dee2e6;
       border-radius: 4px;
       cursor: pointer;
       background: #fff;
       min-height: 80px;
       transition: all 0.15s ease-in-out;
   }
   .inventory-tile:hover {
       border-color: #adb5bd;
       background: #e9ecef;
   }
   .inventory-tile.equipped {
       border-color: var(--bs-success);
       border-width: 2px;
   }
   .equipped-badge {
       position: absolute;
       top: 2px;
       right: 2px;
       background: var(--bs-success);
       color: white;
       border-radius: 50%;
       width: 16px;
       height: 16px;
       font-size: 10px;
       display: flex;
       align-items: center;
       justify-content: center;
   }
   .item-quantity {
       position: absolute;
       bottom: 2px;
       right: 2px;
       background: rgba(0,0,0,0.6);
       color: white;
       padding: 0 4px;
       border-radius: 2px;
       font-size: 11px;
   }
   .item-icon {
       font-size: 24px;
       margin-bottom: 4px;
   }
   .item-name {
       font-size: 11px;
       text-align: center;
       overflow: hidden;
       text-overflow: ellipsis;
       max-width: 100%;
       white-space: nowrap;
   }
   ```

5. Add code section with:
   - List<CharacterItem>? inventoryItems field
   - Dictionary<int, ItemTemplate>? templateCache field
   - OnInitializedAsync that calls LoadItemsAsync()
   - LoadItemsAsync method that:
     - Gets items via itemDal.GetCharacterItemsAsync(Character.Id)
     - Loads templates for each unique ItemTemplateId
     - Caches templates in templateCache dictionary
     - Populates each item's Template property

6. Add helper method GetItemIcon(CharacterItem item) that returns:
   - Emoji based on item type: Weapon="sword", Armor="shield", Consumable="potion", etc.
   - Use these mappings: Weapon="W", Armor="A", Ammunition="*", Consumable="+", Container="[]", Misc="?"
   - Or use Bootstrap icons if available: bi-box, bi-shield, etc.

7. Keep the Currency card from existing code (platinum, gold, silver, copper)

8. Remove old placeholder records (QuickUseItem, EquippedItem, CombatItem) and their lists

Important: Do NOT add selection or click handlers yet - that's Task 2 in Plan 02.
  </action>
  <verify>
Build succeeds: `dotnet build Threa.sln`
Navigate to /play, select a character, click Inventory tab - should see grid layout with items displayed as tiles.
  </verify>
  <done>
Inventory grid displays all character items as tiles with name, icon, quantity badge, and equipped badge. CSS Grid layout is responsive. Currency section preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Equipment Slots Categorized List</name>
  <files>Threa/Threa.Client/Components/Pages/GamePlay/TabPlayInventory.razor</files>
  <action>
Add equipment slots display in the right column:

1. Define slot categories as a static array in code section (per RESEARCH.md pattern):
   ```csharp
   private static readonly SlotCategory[] slotCategories = new[]
   {
       new SlotCategory("Weapons", new[] {
           EquipmentSlot.MainHand,
           EquipmentSlot.OffHand,
           EquipmentSlot.TwoHand
       }),
       new SlotCategory("Head & Neck", new[] {
           EquipmentSlot.Head,
           EquipmentSlot.Face,
           EquipmentSlot.Ears,
           EquipmentSlot.Neck
       }),
       new SlotCategory("Body", new[] {
           EquipmentSlot.Shoulders,
           EquipmentSlot.Back,
           EquipmentSlot.Chest,
           EquipmentSlot.Waist
       }),
       new SlotCategory("Arms", new[] {
           EquipmentSlot.ArmLeft, EquipmentSlot.ArmRight,
           EquipmentSlot.WristLeft, EquipmentSlot.WristRight,
           EquipmentSlot.HandLeft, EquipmentSlot.HandRight
       }),
       new SlotCategory("Legs & Feet", new[] {
           EquipmentSlot.Legs,
           EquipmentSlot.AnkleLeft, EquipmentSlot.AnkleRight,
           EquipmentSlot.FootLeft, EquipmentSlot.FootRight
       }),
       new SlotCategory("Rings - Left", new[] {
           EquipmentSlot.FingerLeft1, EquipmentSlot.FingerLeft2,
           EquipmentSlot.FingerLeft3, EquipmentSlot.FingerLeft4,
           EquipmentSlot.FingerLeft5
       }),
       new SlotCategory("Rings - Right", new[] {
           EquipmentSlot.FingerRight1, EquipmentSlot.FingerRight2,
           EquipmentSlot.FingerRight3, EquipmentSlot.FingerRight4,
           EquipmentSlot.FingerRight5
       })
   };

   private record SlotCategory(string Name, EquipmentSlot[] Slots);
   ```

2. Add markup for equipment slots in right column:
   - Header "Equipment" with card styling
   - Loop through slotCategories
   - For each category, show category name as h6 with text-muted
   - For each slot in category, display:
     - Slot display name (use slot.GetDisplayName())
     - If equipped item exists for slot: show item name
     - If no item: show "Empty" in text-muted
   - Style as a compact list with borders

3. Add helper method GetEquippedItem(EquipmentSlot slot):
   ```csharp
   private CharacterItem? GetEquippedItem(EquipmentSlot slot)
   {
       return inventoryItems?.FirstOrDefault(i => i.IsEquipped && i.EquippedSlot == slot);
   }
   ```

4. Add CSS for equipment slots:
   ```css
   .equipment-slot {
       display: flex;
       justify-content: space-between;
       align-items: center;
       padding: 6px 10px;
       border-bottom: 1px solid #eee;
       font-size: 0.9rem;
   }
   .equipment-slot:last-child {
       border-bottom: none;
   }
   .slot-name {
       color: #6c757d;
       min-width: 120px;
   }
   .slot-item-name {
       font-weight: 500;
   }
   .empty-slot {
       color: #adb5bd;
       font-style: italic;
   }
   .slot-category {
       margin-bottom: 1rem;
   }
   .slot-category h6 {
       margin-bottom: 0.5rem;
       font-size: 0.8rem;
       text-transform: uppercase;
       letter-spacing: 0.05em;
   }
   ```

5. Important per CONTEXT.md: "Show all equipment slots always, including empty ones with placeholder"
   - Display ALL slots in each category, not just ones with items

6. Do NOT show implant slots (per RESEARCH.md Open Questions - defer to future phase)
   - Filter out slots where slot.IsImplant() is true
   - OR simply don't include implant slots in the slotCategories array

7. Keep equipment slots scrollable if they overflow:
   - Wrap in div with max-height and overflow-y: auto
  </action>
  <verify>
Build succeeds: `dotnet build Threa.sln`
Navigate to /play, select character with items, click Inventory tab:
- Equipment slots panel shows all non-implant slots grouped by category
- Equipped items show item name in their slot
- Empty slots show "Empty" text
  </verify>
  <done>
Equipment slots display shows all body/weapon/jewelry slots in categories. Empty slots show placeholder. Equipped items display their names. Implant slots hidden for MVP.
  </done>
</task>

</tasks>

<verification>
1. Run `dotnet build Threa.sln` - must succeed
2. Run the app: `dotnet run --project Threa/Threa`
3. Navigate to /play
4. Select a character (one that has items from character creation)
5. Click "Inventory" tab
6. Verify:
   - Left side shows inventory grid with item tiles
   - Items show name, type icon, quantity (if stackable)
   - Equipped items have green border and "E" badge
   - Right side shows equipment slot categories
   - All slots visible (empty ones say "Empty")
   - Equipped items appear both in grid (with badge) AND in slot (with name)
   - Currency section preserved at bottom
</verification>

<success_criteria>
- INV-07 satisfied: Player can view all items in their inventory on Play page (grid display)
- INV-08 satisfied: Player can view all equipped items in equipment slots on Play page (slot categories)
- Layout matches CONTEXT.md decisions (grid for inventory, list for slots)
- No errors in console
- Responsive layout works at different widths
</success_criteria>

<output>
After completion, create `.planning/phases/04-gameplay-inventory-core/04-01-SUMMARY.md`
</output>
