---
phase: 12-table-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - GameMechanics/GamePlay/TableInfo.cs
  - Threa/Threa.Client/Components/Pages/GameMaster/CampaignCreate.razor
autonomous: true

must_haves:
  truths:
    - "GM can enter a campaign name on a dedicated creation page"
    - "GM can select Fantasy or Sci-Fi theme from a dropdown"
    - "GM can enter a starting epoch time as a raw long value"
    - "Theme-specific default epoch times are applied (0 for Fantasy, 13569465600 for Sci-Fi)"
    - "After creating a campaign, GM is navigated to that campaign's dashboard"
  artifacts:
    - path: "GameMechanics/GamePlay/TableInfo.cs"
      provides: "Theme and StartTimeSeconds properties for list display"
      contains: "ThemeProperty"
    - path: "Threa/Threa.Client/Components/Pages/GameMaster/CampaignCreate.razor"
      provides: "Dedicated campaign creation page at /campaigns/create"
      contains: "@page \"/campaigns/create\""
  key_links:
    - from: "CampaignCreate.razor"
      to: "tablePortal.CreateAsync()"
      via: "IDataPortal injection"
      pattern: "await tablePortal\\.CreateAsync"
    - from: "CampaignCreate.razor"
      to: "NavigationManager"
      via: "Post-creation redirect"
      pattern: "NavigateTo.*gamemaster/table"
---

<objective>
Create the campaign creation page and extend TableInfo to support list display of theme and epoch time.

Purpose: Establish the foundation for GMs to create campaigns with all required fields (name, theme, epoch time) via a dedicated page rather than a modal dialog.

Output:
- Extended TableInfo.cs with Theme and StartTimeSeconds properties
- New CampaignCreate.razor page at /campaigns/create with form for name, theme dropdown, epoch time input
</objective>

<execution_context>
@C:\Users\rocky\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rocky\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12-table-foundation/12-CONTEXT.md
@.planning/phases/12-table-foundation/12-RESEARCH.md

@GameMechanics/GamePlay/TableEdit.cs
@GameMechanics/GamePlay/TableInfo.cs
@Threa.Dal/Dto/GameTable.cs
@Threa/Threa.Client/Components/Pages/GamePlay/GmTable.razor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend TableInfo with Theme and StartTimeSeconds</name>
  <files>GameMechanics/GamePlay/TableInfo.cs</files>
  <action>
Add two new CSLA properties to TableInfo following the existing property pattern:

1. Theme property (string):
   - Use RegisterProperty pattern: `public static readonly PropertyInfo<string> ThemeProperty = RegisterProperty<string>(nameof(Theme));`
   - Getter returns GetProperty(ThemeProperty)
   - Private setter uses LoadProperty(ThemeProperty, value)

2. StartTimeSeconds property (long):
   - Use RegisterProperty pattern: `public static readonly PropertyInfo<long> StartTimeSecondsProperty = RegisterProperty<long>(nameof(StartTimeSeconds));`
   - Getter returns GetProperty(StartTimeSecondsProperty)
   - Private setter uses LoadProperty(StartTimeSecondsProperty, value)

In the FetchChild method, add mappings from the GameTable DTO:
```csharp
Theme = table.Theme ?? "fantasy";
StartTimeSeconds = table.StartTimeSeconds;
```

Reference existing properties like CreatedAt and Status for the exact pattern. The GameTable DTO already has Theme and StartTimeSeconds fields.
  </action>
  <verify>
Run `dotnet build GameMechanics/GameMechanics.csproj` - should compile without errors.
Verify TableInfo has Theme and StartTimeSeconds properties accessible.
  </verify>
  <done>
TableInfo.cs has Theme (string) and StartTimeSeconds (long) properties that map from GameTable DTO in FetchChild.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CampaignCreate.razor page</name>
  <files>Threa/Threa.Client/Components/Pages/GameMaster/CampaignCreate.razor</files>
  <action>
Create a new Blazor page at `/campaigns/create` for campaign creation. Follow these specifications from CONTEXT.md:

**Page structure:**
- Route: `@page "/campaigns/create"`
- RenderMode: InteractiveServer
- Authorization: `[Authorize(Roles = "GameMaster,Administrator")]`
- Inject: IDataPortal for TableEdit, NavigationManager, IJSRuntime

**Form fields:**
1. Campaign Name (text input):
   - Required field
   - Real-time inline validation (show error if empty while typing)
   - Placeholder: "e.g., Rise of the Dragon Lords"

2. Theme (dropdown/select):
   - Options: "Fantasy (Arcanum)" and "Sci-Fi (Neon Circuit)"
   - Default: Fantasy pre-selected
   - On change: Update epoch time default, apply theme preview via JS interop

3. Theme Preview Card:
   - Show a card/panel that uses CSS variables to preview the selected theme
   - Display theme-appropriate text (fantasy: "Ancient tomes...", scifi: "Neon circuits...")
   - Use `style="background: var(--color-card-bg); border: var(--border-style);"` etc.

4. Starting Epoch Time (number input):
   - Type: number (accepts full long range including negatives)
   - Default: 0 for Fantasy, 13569465600 for Sci-Fi (year 2400)
   - NO min constraint (negatives allowed for pre-epoch times)
   - Show helper text explaining the default value

**Buttons:**
- "Create Campaign" - disabled if name is empty
- "Cancel" - navigates back to /gamemaster/tables

**Theme preview behavior:**
- Store original theme on page load via `JS.InvokeAsync<string>("threaTheme.get")`
- Apply selected theme on theme change via `JS.InvokeVoidAsync("threaTheme.apply", theme)`
- On Cancel, restore original theme before navigating away

**Create action:**
1. Create new table via tablePortal.CreateAsync()
2. Set Name, Theme, StartTimeSeconds
3. Save via tablePortal.UpdateAsync(newTable)
4. Navigate to `/gamemaster/table/{newTable.Id}`

Reference GmTable.razor for the JS interop pattern and Tables.razor for the creation pattern.
  </action>
  <verify>
1. Run `dotnet build Threa/Threa/Threa.csproj` - should compile without errors
2. Navigate to https://localhost:7133/campaigns/create as a GM user
3. Verify form shows name input, theme dropdown, epoch time input
4. Verify theme dropdown changes the preview styling
5. Verify selecting Sci-Fi changes epoch default to 13569465600
6. Verify Create button is disabled when name is empty
  </verify>
  <done>
CampaignCreate.razor exists at /campaigns/create with:
- Name input with validation
- Theme dropdown with Fantasy/Sci-Fi options
- Theme preview card that updates styling
- Epoch time input with theme-specific defaults
- Create navigates to campaign dashboard
- Cancel restores original theme and navigates to tables list
  </done>
</task>

</tasks>

<verification>
1. Build passes: `dotnet build Threa.sln`
2. TableInfo has Theme and StartTimeSeconds properties
3. /campaigns/create page loads for GM users
4. Creating a campaign navigates to its dashboard
5. Theme preview updates when theme selection changes
</verification>

<success_criteria>
- [ ] TableInfo.cs extended with Theme and StartTimeSeconds CSLA properties
- [ ] CampaignCreate.razor page exists at /campaigns/create
- [ ] Form includes name, theme dropdown, and epoch time input
- [ ] Theme-specific defaults applied (0 for Fantasy, 13569465600 for Sci-Fi)
- [ ] Theme preview card shows theme-appropriate styling
- [ ] Create button saves and navigates to dashboard
- [ ] Cancel restores original theme and returns to tables list
</success_criteria>

<output>
After completion, create `.planning/phases/12-table-foundation/12-01-SUMMARY.md`
</output>
