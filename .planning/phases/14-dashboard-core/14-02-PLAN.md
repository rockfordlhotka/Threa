---
phase: 14-dashboard-core
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - Threa/Threa.Client/Components/Shared/CharacterStatusCard.razor
  - Threa/Threa.Client/Components/Shared/CharacterStatusCard.razor.cs
  - Threa/Threa/wwwroot/css/themes.css
autonomous: true

must_haves:
  truths:
    - "CharacterStatusCard displays character name prominently"
    - "CharacterStatusCard shows stacked FAT/VIT health bars using PendingPoolBar"
    - "CharacterStatusCard shows AP badge, wounds badge, and effects badge"
    - "Badges show tooltip on hover with detail lists"
    - "Card border color indicates health state (green/yellow/red/dark)"
  artifacts:
    - path: "Threa/Threa.Client/Components/Shared/CharacterStatusCard.razor"
      provides: "Compact character status card component"
      contains: "PendingPoolBar"
    - path: "Threa/Threa.Client/Components/Shared/CharacterStatusCard.razor.cs"
      provides: "Code-behind with health state logic"
      contains: "GetHealthStateClass"
  key_links:
    - from: "Threa/Threa.Client/Components/Shared/CharacterStatusCard.razor"
      to: "GameMechanics/GamePlay/TableCharacterInfo"
      via: "Parameter binding"
      pattern: "\\[Parameter\\].*TableCharacterInfo"
    - from: "CharacterStatusCard.razor"
      to: "PendingPoolBar.razor"
      via: "Component reference"
      pattern: "<PendingPoolBar"
---

<objective>
Create the CharacterStatusCard Blazor component for compact character status display in the GM dashboard.

Purpose: Provide a reusable, visually rich card component that displays character health, pending pools, AP, wounds, and effects in a compact format suitable for dashboard grid display.
Output: CharacterStatusCard.razor component with code-behind, integrated with existing PendingPoolBar and Bootstrap tooltips.
</objective>

<execution_context>
@C:\Users\rocky\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rocky\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/14-dashboard-core/14-CONTEXT.md
@.planning/phases/14-dashboard-core/14-RESEARCH.md
@.planning/phases/14-dashboard-core/14-01-SUMMARY.md

@Threa/Threa.Client/Components/Shared/PendingPoolBar.razor
@Threa/Threa.Client/Components/Shared/PendingPoolBar.razor.cs
@GameMechanics/GamePlay/TableCharacterInfo.cs
@Threa/Threa/wwwroot/css/themes.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CharacterStatusCard code-behind</name>
  <files>
    Threa/Threa.Client/Components/Shared/CharacterStatusCard.razor.cs
  </files>
  <action>
Create the code-behind class following existing patterns (like PendingPoolBar.razor.cs):

```csharp
using Microsoft.AspNetCore.Components;
using GameMechanics.GamePlay;

namespace Threa.Client.Components.Shared;

public class CharacterStatusCardBase : ComponentBase
{
    [Parameter] public TableCharacterInfo Character { get; set; } = null!;
    [Parameter] public EventCallback<TableCharacterInfo> OnClick { get; set; }
    [Parameter] public bool IsSelected { get; set; }

    protected string CardBorderClass => GetHealthStateClass();

    /// <summary>
    /// Determines card border color based on health state per CONTEXT.md:
    /// - Green: Healthy (no critical conditions)
    /// - Yellow: Wounded (FAT <= 25% OR VIT <= 50% OR has wounds)
    /// - Red: Critical (VIT <= 25%)
    /// - Dark: Unconscious (FAT <= 0)
    /// </summary>
    protected string GetHealthStateClass()
    {
        if (Character.FatValue <= 0) return "border-dark";

        var vitPercent = Character.VitMax > 0 ? Character.VitValue * 100 / Character.VitMax : 0;
        var fatPercent = Character.FatMax > 0 ? Character.FatValue * 100 / Character.FatMax : 0;

        if (vitPercent <= 25) return "border-danger";
        if (fatPercent <= 25 || vitPercent <= 50 || Character.WoundCount > 0) return "border-warning";
        return "border-success";
    }

    protected string GetConnectionClass()
    {
        return Character.ConnectionStatus switch
        {
            Threa.Dal.Dto.ConnectionStatus.Connected => "connected",
            Threa.Dal.Dto.ConnectionStatus.Disconnected => "disconnected",
            Threa.Dal.Dto.ConnectionStatus.Away => "away",
            _ => ""
        };
    }

    protected string WoundTooltipHtml => string.IsNullOrEmpty(Character.WoundSummary)
        ? "No wounds"
        : Character.WoundSummary.Replace(", ", "<br/>");

    protected string EffectTooltipHtml => string.IsNullOrEmpty(Character.EffectSummary)
        ? "No active effects"
        : Character.EffectSummary.Replace(", ", "<br/>");
}
```
  </action>
  <verify>
`dotnet build Threa/Threa.Client/Threa.Client.csproj` compiles without errors.
  </verify>
  <done>
CharacterStatusCardBase class created with health state calculation logic, connection status helpers, and tooltip HTML generation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CharacterStatusCard razor markup</name>
  <files>
    Threa/Threa.Client/Components/Shared/CharacterStatusCard.razor
  </files>
  <action>
Create the Blazor component markup following CONTEXT.md specifications:

```razor
@namespace Threa.Client.Components.Shared
@inherits CharacterStatusCardBase

<div class="character-status-card card @CardBorderClass @(IsSelected ? "selected" : "") mb-2"
     @onclick="() => OnClick.InvokeAsync(Character)"
     style="cursor: pointer;">
    <div class="card-body py-2 px-3">
        @* Header: Name and connection status *@
        <div class="d-flex justify-content-between align-items-center mb-2">
            <strong class="text-truncate" style="max-width: 140px;" title="@Character.CharacterName">
                @Character.CharacterName
            </strong>
            <span class="status-indicator @GetConnectionClass()" title="@Character.ConnectionStatusDisplay"></span>
        </div>

        @* Health Bars: FAT over VIT, stacked - using PendingPoolBar *@
        <div class="mb-2">
            <div class="d-flex align-items-center gap-1 mb-1">
                <small class="text-muted" style="width: 28px; font-size: 0.7rem;">FAT</small>
                <div class="flex-grow-1">
                    <PendingPoolBar CurrentValue="@Character.FatValue"
                                   MaxValue="@Character.FatMax"
                                   PendingDamage="@Character.FatPendingDamage"
                                   PendingHealing="@Character.FatPendingHealing"
                                   Height="6px" />
                </div>
            </div>
            <div class="d-flex align-items-center gap-1">
                <small class="text-muted" style="width: 28px; font-size: 0.7rem;">VIT</small>
                <div class="flex-grow-1">
                    <PendingPoolBar CurrentValue="@Character.VitValue"
                                   MaxValue="@Character.VitMax"
                                   PendingDamage="@Character.VitPendingDamage"
                                   PendingHealing="@Character.VitPendingHealing"
                                   Height="6px" />
                </div>
            </div>
        </div>

        @* Status Badges: AP, Wounds, Effects *@
        <div class="d-flex gap-1 flex-wrap">
            <span class="badge bg-primary" style="font-size: 0.7rem;" title="Action Points">
                <i class="bi bi-lightning-charge"></i> @Character.ActionPoints/@Character.ActionPointMax
            </span>
            @if (Character.WoundCount > 0)
            {
                <span class="badge bg-warning text-dark"
                      style="font-size: 0.7rem;"
                      data-bs-toggle="tooltip"
                      data-bs-html="true"
                      data-bs-placement="top"
                      title="@WoundTooltipHtml">
                    <i class="bi bi-bandaid"></i> @Character.WoundCount
                </span>
            }
            @if (Character.EffectCount > 0)
            {
                <span class="badge bg-info"
                      style="font-size: 0.7rem;"
                      data-bs-toggle="tooltip"
                      data-bs-html="true"
                      data-bs-placement="top"
                      title="@EffectTooltipHtml">
                    <i class="bi bi-stars"></i> @Character.EffectCount
                </span>
            }
        </div>
    </div>
</div>
```

Key implementation notes:
- Use existing PendingPoolBar component for health visualization (reuse, don't rebuild)
- Bootstrap tooltips via data-bs-* attributes (initialized by parent page)
- Card border classes for health state indication
- Connection status indicator dot (using existing .status-indicator CSS class)
- Compact badges for AP, wounds, effects
- Text truncation on character name to prevent overflow
  </action>
  <verify>
`dotnet build Threa/Threa.Client/Threa.Client.csproj` compiles without errors.
  </verify>
  <done>
CharacterStatusCard.razor created with compact card layout using PendingPoolBar for health bars and Bootstrap badges for status indicators.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add CharacterStatusCard CSS to themes.css</name>
  <files>
    Threa/Threa/wwwroot/css/themes.css
  </files>
  <action>
Add CSS for the CharacterStatusCard component at the end of themes.css (before the closing section if any).

```css
/* Character Status Card - GM Dashboard */
.character-status-card {
    transition: all 0.2s ease;
    border-width: 2px;
}

.character-status-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-card), 0 4px 12px rgba(0, 0, 0, 0.15);
}

.character-status-card.selected {
    box-shadow: 0 0 0 3px var(--color-accent-gold);
}

/* Health state borders using theme colors */
.character-status-card.border-success {
    border-color: var(--color-accent-green, #198754) !important;
}

.character-status-card.border-warning {
    border-color: var(--color-accent-gold, #ffc107) !important;
}

.character-status-card.border-danger {
    border-color: var(--color-accent-red, #dc3545) !important;
}

.character-status-card.border-dark {
    border-color: var(--color-text-muted, #6c757d) !important;
    opacity: 0.7;
}

/* Sci-Fi theme enhancements */
[data-theme="scifi"] .character-status-card:hover {
    box-shadow: var(--glow-primary, 0 0 15px rgba(0, 255, 255, 0.3));
}

[data-theme="scifi"] .character-status-card.selected {
    box-shadow: var(--glow-secondary, 0 0 20px rgba(255, 0, 255, 0.4));
}
```

Note: The themes.css file may already have CSS variables defined. Use those variables where available, with fallback values for safety.
  </action>
  <verify>
`dotnet build Threa/Threa/Threa.csproj` compiles without errors.
CSS syntax valid (no build errors from static file processing).
  </verify>
  <done>
CharacterStatusCard CSS added to themes.css with theme-aware styling for borders, hover effects, and selected state.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build Threa.sln` - solution compiles
2. CharacterStatusCard.razor exists with PendingPoolBar integration
3. CharacterStatusCard.razor.cs exists with health state logic
4. themes.css includes .character-status-card styles
</verification>

<success_criteria>
- CharacterStatusCard component renders character name, health bars, and status badges
- Health bars use PendingPoolBar component showing pending damage/healing
- Badges appear for AP (always), wounds (if > 0), effects (if > 0)
- Card border color reflects health state (green/yellow/red/dark)
- Component supports OnClick event and IsSelected state
- Styling works in both fantasy and sci-fi themes
</success_criteria>

<output>
After completion, create `.planning/phases/14-dashboard-core/14-02-SUMMARY.md`
</output>
