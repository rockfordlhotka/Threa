---
phase: 02-gm-item-management
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Threa/Threa.Client/Components/Pages/GameMaster/Items.razor
autonomous: true

must_haves:
  truths:
    - "GM can see all item templates in a data grid"
    - "GM can filter items by ItemType using dropdown"
    - "GM can search items by name with debounced input"
    - "GM can click a row to navigate to edit page"
    - "Search filters across Name, Description, and Tags"
  artifacts:
    - path: "Threa/Threa.Client/Components/Pages/GameMaster/Items.razor"
      provides: "Enhanced list page with filtering and search"
      contains: "RadzenDataGrid"
  key_links:
    - from: "Items.razor"
      to: "ItemEdit.razor"
      via: "Navigation on row click"
      pattern: "NavigateTo.*gamemaster/items"
    - from: "Items.razor filter"
      to: "filteredItems"
      via: "ApplyFilters method"
      pattern: "ApplyFilters"
---

<objective>
Replace QuickGrid with RadzenDataGrid and add filtering/search capabilities to the item template list page.

Purpose: Enable GMs to efficiently browse and find item templates by type or keyword search. Per CONTEXT.md: data table format, minimal columns (Name, Type), click-through navigation (no inline actions).

Output: Enhanced Items.razor with RadzenDataGrid, type filter dropdown, and debounced search box.
</objective>

<execution_context>
@C:\Users\rocky\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rocky\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-gm-item-management/02-CONTEXT.md
@.planning/phases/02-gm-item-management/02-RESEARCH.md

# Current file to enhance
@Threa/Threa.Client/Components/Pages/GameMaster/Items.razor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace QuickGrid with RadzenDataGrid</name>
  <files>
    Threa/Threa.Client/Components/Pages/GameMaster/Items.razor
  </files>
  <action>
Replace the existing QuickGrid with RadzenDataGrid. Follow CONTEXT.md decisions:

1. **Remove** the QuickGrid import and the QuickGrid component
2. **Add** RadzenDataGrid with these features:
   - Data bound to `filteredItems` (IEnumerable, not IQueryable)
   - TItem="ItemTemplateInfo"
   - AllowSorting="true"
   - AllowPaging="true" PageSize="20"
   - RowSelect event that navigates to `/gamemaster/items/{item.Id}`
   - Style="cursor: pointer" for row hover indication

3. **Columns** (minimal per CONTEXT.md):
   - Name column: Property="Name", Sortable, Width="300px"
   - Type column: Property="ItemType", Sortable, Width="150px"

4. **Remove** the Actions column with Edit/Delete links (per CONTEXT.md: "click through only")

5. **Keep** the "Add New Item" button at the top

Example pattern from RESEARCH.md:
```razor
<RadzenDataGrid Data="@filteredItems" TItem="ItemTemplateInfo"
    AllowSorting="true" AllowPaging="true" PageSize="20"
    RowSelect="@(item => NavigationManager.NavigateTo($"/gamemaster/items/{item.Id}"))"
    Style="cursor: pointer">
    <Columns>
        <RadzenDataGridColumn TItem="ItemTemplateInfo" Property="Name" Title="Name" Sortable="true" Width="300px" />
        <RadzenDataGridColumn TItem="ItemTemplateInfo" Property="ItemType" Title="Type" Sortable="true" Width="150px" />
    </Columns>
</RadzenDataGrid>
```

6. **Update code block**:
   - Change `items` to `allItems` and `filteredItems` (both IEnumerable<ItemTemplateInfo>)
   - Initialize filteredItems = allItems after fetch
   - Inject NavigationManager if not already injected
  </action>
  <verify>
    dotnet build Threa.sln
  </verify>
  <done>
    QuickGrid replaced with RadzenDataGrid. Clicking a row navigates to edit page. No inline action buttons.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add type filter and debounced search</name>
  <files>
    Threa/Threa.Client/Components/Pages/GameMaster/Items.razor
  </files>
  <action>
Add filtering and search controls above the data grid:

1. **Search box** with debounce:
   - RadzenTextBox with placeholder "Search items..."
   - @oninput handler calls OnSearchInput(value)
   - Debounce 300ms using System.Timers.Timer
   - Search across Name, Description, and Tags (when Tags property is available)

2. **Type filter dropdown**:
   - RadzenDropDown with ItemType? nullable
   - Data from Enum.GetValues<ItemType>()
   - AllowClear="true" for "show all"
   - Placeholder="Filter by Type"
   - Change event calls ApplyFilters()

3. **ApplyFilters() method**:
   ```csharp
   private void ApplyFilters()
   {
       var query = allItems?.AsEnumerable() ?? Enumerable.Empty<ItemTemplateInfo>();

       if (selectedType.HasValue)
           query = query.Where(i => i.ItemType == selectedType.Value);

       if (!string.IsNullOrWhiteSpace(searchText))
           query = query.Where(i =>
               i.Name.Contains(searchText, StringComparison.OrdinalIgnoreCase) ||
               i.Description.Contains(searchText, StringComparison.OrdinalIgnoreCase));
               // Note: Tags search added in Plan 03 after Tags property available

       filteredItems = query.ToList();
   }
   ```

4. **OnSearchInput() with debounce**:
   ```csharp
   private System.Timers.Timer? debounceTimer;
   private const int DebounceMs = 300;

   private void OnSearchInput(string value)
   {
       searchText = value;
       debounceTimer?.Stop();
       debounceTimer?.Dispose();
       debounceTimer = new System.Timers.Timer(DebounceMs);
       debounceTimer.Elapsed += (s, e) =>
       {
           debounceTimer?.Stop();
           InvokeAsync(() => { ApplyFilters(); StateHasChanged(); });
       };
       debounceTimer.Start();
   }
   ```

5. **Implement IDisposable** to dispose the timer:
   ```csharp
   @implements IDisposable

   public void Dispose()
   {
       debounceTimer?.Stop();
       debounceTimer?.Dispose();
   }
   ```

6. **Layout** (per CONTEXT.md: search prominent at top):
   ```razor
   <div class="d-flex gap-3 mb-3 align-items-center">
       <RadzenTextBox @bind-Value="@searchText" Placeholder="Search items..."
           @oninput="@((e) => OnSearchInput(e.Value?.ToString() ?? ""))"
           Style="width: 300px" />
       <RadzenDropDown TValue="ItemType?" Data="@Enum.GetValues<ItemType>()"
           @bind-Value="@selectedType" Change="@(_ => ApplyFilters())"
           Placeholder="Filter by Type" AllowClear="true" Style="width: 200px" />
   </div>
   ```
  </action>
  <verify>
    dotnet build Threa.sln
  </verify>
  <done>
    Type filter dropdown filters by ItemType. Search box with 300ms debounce searches Name and Description. Clear button on dropdown shows all items.
  </done>
</task>

<task type="auto">
  <name>Task 3: Manual verification of list page functionality</name>
  <files></files>
  <action>
Run the application and manually verify the list page works as expected:

1. Start the application: `dotnet run --project Threa/Threa`
2. Navigate to https://localhost:7133/gamemaster/items (or the configured port)
3. Verify:
   - Items display in RadzenDataGrid with Name and Type columns
   - Clicking a row navigates to /gamemaster/items/{id}
   - Type dropdown filters to show only selected type
   - Clearing type dropdown shows all items
   - Search box filters items by name (with debounce - no flicker during typing)
   - "Add New Item" button still works

If any issues found, fix them before completing this task.
  </action>
  <verify>
    Manual testing in browser
  </verify>
  <done>
    List page displays items, filters by type, searches by keyword, and navigates to edit on row click.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build Threa.sln` - No compilation errors
2. Manual test: Navigate to /gamemaster/items
3. Manual test: Type filter dropdown works (select "Weapon", see only weapons)
4. Manual test: Search box filters (type "sword", see swords)
5. Manual test: Click row navigates to edit page
6. Manual test: Clear filter shows all items
</verification>

<success_criteria>
- RadzenDataGrid replaces QuickGrid with Name and Type columns
- Row click navigates to edit page (no inline action buttons)
- Type filter dropdown filters by ItemType with clear option
- Search box with 300ms debounce searches Name and Description
- IDisposable properly disposes debounce timer
- Page renders correctly and is responsive
</success_criteria>

<output>
After completion, create `.planning/phases/02-gm-item-management/02-02-SUMMARY.md`
</output>
