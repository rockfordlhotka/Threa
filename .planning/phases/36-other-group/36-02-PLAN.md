---
phase: 36-other-group
plan: 02
type: execute
wave: 2
depends_on: ["36-01"]
files_modified:
  - Threa/Threa.Client/Components/Pages/GamePlay/TabCombat.razor
  - Threa/Threa/wwwroot/css/themes.css
autonomous: true

must_haves:
  truths:
    - "Action group buttons are visually dimmed (combat-tile-dimmed class) when the player lacks AP/FAT to use them"
    - "Defense group Defend button uses combat-tile-dimmed class (replacing combat-tile-passive-only) when active defense is unavailable"
    - "Other group buttons are visually dimmed when the player lacks AP/FAT for the action"
    - "Dimmed buttons show cost-explaining tooltips (e.g., 'Attack requires 1 AP + 1 FAT')"
    - "Dimmed buttons remain clickable (CSS class only, not HTML disabled attribute)"
    - "Disabled attribute is only used for hard blocks: passed out, no weapon, precondition failures"
    - "Defend button retains its semantic meaning: passive-only dimming when AP is insufficient for active defense"
  artifacts:
    - path: "Threa/Threa.Client/Components/Pages/GamePlay/TabCombat.razor"
      provides: "Dimming classes and cost tooltips on all combat tile groups"
      contains: "combat-tile-dimmed"
    - path: "Threa/Threa/wwwroot/css/themes.css"
      provides: "Consolidated dimming CSS"
      contains: "combat-tile-dimmed"
  key_links:
    - from: "Actions group buttons"
      to: "combat-tile-dimmed CSS class"
      via: "Conditional class when !CanAct()"
      pattern: "combat-tile-dimmed"
    - from: "Other group buttons"
      to: "combat-tile-dimmed CSS class"
      via: "Conditional class when !CanAct() or !CanRest()"
      pattern: "combat-tile-dimmed"
---

<objective>
Apply cost-aware dimming across all three combat tile groups for visual consistency.

Purpose: Give players clear visual feedback when they lack sufficient AP/FAT to perform actions, with tooltips explaining the cost. This creates a consistent visual language across Actions, Defense, and Other groups.

Output: Modified TabCombat.razor with combat-tile-dimmed class applied conditionally to all combat tiles, cost-explaining tooltips, and disabled attribute reserved for hard blocks only. Updated themes.css to consolidate dimming (replace combat-tile-passive-only with combat-tile-dimmed on the Defend button).
</objective>

<execution_context>
@C:\Users\rocky\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rocky\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/36-other-group/36-CONTEXT.md
@.planning/phases/36-other-group/36-RESEARCH.md
@.planning/phases/36-other-group/36-01-SUMMARY.md
@Threa/Threa.Client/Components/Pages/GamePlay/TabCombat.razor
@Threa/Threa/wwwroot/css/themes.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Apply dimming and cost tooltips to Actions group buttons</name>
  <files>Threa/Threa.Client/Components/Pages/GamePlay/TabCombat.razor</files>
  <action>
For each button in the **Actions group** (Attack, Target, Ranged, Ranged Target, Action, Use Skill), apply two changes:

**1. Add conditional combat-tile-dimmed class** when `!CanAct()`:

Change the class attribute pattern from:
```html
class="btn combat-tile combat-tile-actions"
```
To:
```html
class="btn combat-tile combat-tile-actions @(!CanAct() ? "combat-tile-dimmed" : "")"
```

Apply this to ALL six Actions group buttons.

**2. Change disabled to only block on IsPassedOut** (hard block):

For buttons that currently use `disabled="@(!CanAct())"`, change to `disabled="@(Character?.IsPassedOut ?? true)"`.

For buttons with compound disabled conditions, simplify:
- Attack: `disabled="@(Character?.IsPassedOut ?? true)"` (was `!CanAct()`)
- Target: `disabled="@(Character?.IsPassedOut ?? true || !HasTargetsAvailable())"` (was `!CanAct() || !HasTargetsAvailable()`) — Note: keep `!HasTargetsAvailable()` as a hard block since there are literally no targets.
- Ranged: `disabled="@(Character?.IsPassedOut ?? true)"` (was `!CanAct() || !hasRangedWeaponEquipped`) — Note: this button is already guarded by... wait, Ranged is NOT @if-guarded (only in Other group). For Ranged and Ranged Target in the Actions group, keep the `!hasRangedWeaponEquipped` check as disabled since having no ranged weapon is a hard precondition, not a resource issue. So:
  - Ranged: `disabled="@(Character?.IsPassedOut ?? true || !hasRangedWeaponEquipped)"`
  - Ranged Target: `disabled="@(Character?.IsPassedOut ?? true || !hasRangedWeaponEquipped || !HasTargetsAvailable())"`
- Action: `disabled="@(Character?.IsPassedOut ?? true)"`
- Use Skill: `disabled="@(Character?.IsPassedOut ?? true)"`

**3. Add cost-explaining tooltips** when dimmed:

For each button, make the title conditional on CanAct():
- Attack: `title="@(CanAct() ? "Melee attack (1 AP + 1 FAT)" : "Attack requires 1 AP + 1 FAT")"`
- Target: `title="@(CanAct() ? "Attack a target at your table" : "Attack requires 1 AP + 1 FAT")"`
- Ranged: keep existing conditional tooltip for weapon equipped; add dimming cost: `title="@(!hasRangedWeaponEquipped ? "No ranged weapon equipped" : !CanAct() ? "Ranged attack requires 1 AP + 1 FAT" : "Ranged attack")"`
- Ranged Target: `title="@(!hasRangedWeaponEquipped ? "No ranged weapon equipped" : !CanAct() ? "Ranged attack requires 1 AP + 1 FAT" : "Ranged attack on a target at your table")"`
- Action: `title="@(CanAct() ? "Attribute-only roll vs TV (1 AP + 1 FAT)" : "Action requires 1 AP + 1 FAT")"`
- Use Skill: `title="@(CanAct() ? "Skill check from any skill" : "Skill check requires 1 AP + 1 FAT")"`
  </action>
  <verify>
Build compiles: `dotnet build Threa.sln`
Grep for `combat-tile-dimmed` in TabCombat.razor Actions group confirms dimming is applied.
Grep for `IsPassedOut` confirms disabled only blocks on passed out (plus equipment preconditions where applicable).
  </verify>
  <done>
All six Actions group buttons have conditional combat-tile-dimmed class, disabled reserved for hard blocks, and cost-explaining tooltips.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply dimming to Defense and Other groups, consolidate CSS</name>
  <files>
    Threa/Threa.Client/Components/Pages/GamePlay/TabCombat.razor
    Threa/Threa/wwwroot/css/themes.css
  </files>
  <action>
**Defense group — Defend button:**

The Defend button currently uses `combat-tile-passive-only` for its dimming. Replace this with `combat-tile-dimmed` for naming consistency:

Change:
```html
class="btn combat-tile combat-tile-defense @(CanPerformActiveDefenseForStance() ? "" : "combat-tile-passive-only")"
```
To:
```html
class="btn combat-tile combat-tile-defense @(CanPerformActiveDefenseForStance() ? "" : "combat-tile-dimmed")"
```

The Defend button's disabled and title remain as-is — its dimming semantics are "passive defense only" (no AP for active), which is already correct.

**Defense group — Take Damage button:**
Take Damage has no AP cost and should NOT be dimmed. Leave it exactly as-is.

**Other group — Medical button:**
Add dimming class and cost tooltip:
```html
<button class="btn combat-tile combat-tile-other @(!CanAct() ? "combat-tile-dimmed" : "")"
        @onclick="StartMedical"
        disabled="@(Character?.IsPassedOut ?? true)"
        title="@(CanAct() ? "First-Aid, Nursing, Doctor (1 AP + 1 FAT)" : "Medical requires 1 AP + 1 FAT")">
```

**Other group — Rest button:**
Add dimming class and cost tooltip. Rest uses `CanRest()` not `CanAct()`:
```html
<button class="btn combat-tile combat-tile-other @(!CanRest() && !(Character?.IsPassedOut ?? true) ? "combat-tile-dimmed" : "")"
        @onclick="StartRest"
        disabled="@(Character?.IsPassedOut ?? true)"
        title="@(CanRest() ? "Spend 1 AP to recover 1 FAT" : Character?.Fatigue.Value >= Character?.Fatigue.BaseValue ? "Fatigue is already at maximum" : "Rest requires 1 AP")">
```

Note the dimming condition: `!CanRest() && !IsPassedOut` — we don't double-dim when already disabled. The tooltip distinguishes between "FAT at max" and "AP insufficient."

**Other group — Reload button (inside @if):**
Add dimming class and cost tooltip:
```html
<button class="btn combat-tile combat-tile-other @(!CanAct() ? "combat-tile-dimmed" : "")"
        @onclick="StartReload"
        disabled="@(Character?.IsPassedOut ?? true)"
        title="@(CanAct() ? "Reload a ranged weapon (1 AP + 1 FAT)" : "Reload requires 1 AP + 1 FAT")">
```

**Other group — Unload button (inside @if):**
Add dimming class and cost tooltip:
```html
<button class="btn combat-tile combat-tile-other @(!CanAct() ? "combat-tile-dimmed" : "")"
        @onclick="StartUnload"
        disabled="@(Character?.IsPassedOut ?? true)"
        title="@(CanAct() ? "Remove ammo from weapon (1 AP + 1 FAT)" : "Unload requires 1 AP + 1 FAT")">
```

**Other group — Implants button (inside @if):**
Implants have per-toggle AP cost. Apply dimming when AP < 1:
```html
<button class="btn combat-tile combat-tile-other @(Character?.ActionPoints.Available < 1 ? "combat-tile-dimmed" : "")"
        @onclick="StartActivateImplant"
        disabled="@(Character?.IsPassedOut ?? true)"
        title="@(Character?.ActionPoints.Available >= 1 ? "Activate / Deactivate implants" : "Implant activation requires AP")">
```

**themes.css — Consolidate dimming:**
Remove the `combat-tile-passive-only` class since it's no longer referenced anywhere (replaced by `combat-tile-dimmed` on the Defend button). The `.combat-tile-dimmed` class added in Plan 01 covers this.

Delete:
```css
.combat-tile-passive-only {
    opacity: 0.65;
}
```
  </action>
  <verify>
Build compiles: `dotnet build Threa.sln`
Grep for `combat-tile-passive-only` in TabCombat.razor returns NO results (fully replaced).
Grep for `combat-tile-passive-only` in themes.css returns NO results (removed).
Grep for `combat-tile-dimmed` in TabCombat.razor confirms class is applied across all three groups.
Count of `combat-tile-dimmed` occurrences in TabCombat.razor should be >= 9 (6 Actions + 1 Defend + Medical + Rest + Reload + Unload + Implants = ~12, minus Take Damage which is excluded).
  </verify>
  <done>
All combat tile groups have consistent cost-aware dimming. Dimmed buttons show cost tooltips. Disabled attribute reserved for hard blocks only. combat-tile-passive-only is removed and replaced by combat-tile-dimmed everywhere.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build Threa.sln` passes with no errors
2. No references to `combat-tile-passive-only` remain in any file
3. `combat-tile-dimmed` appears on buttons in all three groups (Actions, Defense, Other)
4. Actions group: 6 buttons with conditional dimming class
5. Defense group: Defend button uses combat-tile-dimmed (not combat-tile-passive-only)
6. Other group: Medical, Rest, Reload, Unload, Implants all have conditional dimming
7. Take Damage button has NO dimming class (it has no AP cost)
8. All dimmed buttons have cost-explaining tooltips
9. disabled attribute is only used for hard blocks (IsPassedOut, no weapon, no targets)
</verification>

<success_criteria>
- Build succeeds
- Consistent dimming visual across all three groups
- Cost-explaining tooltips on all dimmed buttons
- No stale combat-tile-passive-only references remain
- Disabled reserved for hard precondition failures only
</success_criteria>

<output>
After completion, create `.planning/phases/36-other-group/36-02-SUMMARY.md`
</output>
